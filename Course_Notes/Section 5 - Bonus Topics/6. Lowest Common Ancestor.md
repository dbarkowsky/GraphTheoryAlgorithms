Also as LCA
Finding first shared ancestor of nodes in a tree.
Tricky bit: the node can be a descendant of itself.

We're specifically looking at trees here, but also applies to DAGs.
Very common in other algorithms and data structures.

There are actually many ways to do this, but we'll use the *Eulerian tour + Range Minimum Query* method.

It's a good thing we did [[5. Sparse Tables]], because that's needed here for best efficiency.

## Before We Begin
1. Make sure your tree is rooted. AKA has a top-level root.
2. All nodes must be uniquely indexed. If they're not, just assign a numeric ID starting at 0.

## Algorithm
Do a Eulerian tour on edges of the tree.
But not the existing edges :)
Instead, we're going to doubly link the trees with new edges. So for every existing edge, create two edges in opposite directions.

### Build the List
1. Create these new edges.
2. Start at root and traverse all new edges until returned to the root.
	1. Keep track of visited nodes while we do this. This part is the Eulerian Tour. Nodes may appear more than once in this list.
	2. As we tour, track the depth of each node as well. The root is depth 0. A node we've already visited is going up a depth, new nodes mean we're going down.
	3. You can do those two things in parallel arrays.

### Find LCA
1. Given nodes A and B, find their index positions in the Eulerian tour.
2. Using the depth array, find the index of the minimum depth value identified between the two indexes found in step 1.
3. With the index found in step 2, look back to the Eulerian tour array and see what node ID is in that index.

What about the nodes that are visited twice? They have two index positions.
Turns out it doesn't matter, but be consistent. Doesn't affect the value obtained from minimum range query.
Suggestion: always pick the last found index if there's more than one.

## Inverse Map
Can also include another array that tracks the last occurrence of the node and what index it was found at in the Eulerian tour array.

## Other
Where is the [[5. Sparse Tables]] part used? That's constructed during the tour. It allows for O(1) lookup for LCA, which doesn't matter with small trees, but *really* matters for big ones.
